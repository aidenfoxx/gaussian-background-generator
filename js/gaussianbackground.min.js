/** 
 * Gaussian Background Generator 
 * 
 * @version    0.5.0
 * @author     Aiden Foxx
 * @license    MIT License 
 * @copyright  2015 Aiden Foxx
 * @link       http://github.com/aidenfoxx
 * @twitter    @furiousfoxx
 */
"use strict";function GaussianBackground(t,i,s){return this instanceof GaussianBackground?(this.context=null,this.animationFrame=null,this.timestep=0,this.firstCallTime=0,this.lastCallTime=0,this.timeElapsed=0,this.fpsAverage=0,this.fpsTotal=0,this.layers={},this.layersBackup={},this.options={debug:!1,blur:!0,blurRadius:50,blurMethod:"stackblur",blurIterations:0,animation:!0,fpsCap:20,renderWidth:320,renderHeight:130},(this.context=t.getContext("2d"))?(this.updateOptions(s),this.updateLayers(i),this.context.canvas.width=this.options.renderWidth,this.context.canvas.height=this.options.renderHeight,this.firstCallTime=Date.now(),this.lastCallTime=this.firstCallTime,window.cancelAnimationFrame(this.animationFrame),void(this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this)))):(console.log("ERROR: Could not load canvas"),!1)):new GaussianBackground(t,i,s)}GaussianBackground.prototype.generateLayer=function(t,i,s,e,n,a){var o=document.createElement("canvas");o.width=this.options.renderWidth,o.height=this.options.renderHeight;for(var r={orbs:{},color:e,context:o.getContext("2d")},h=n||0,d=a||0,l=0,p=0,u=0;t>u;u++){var c=0,m=this.options.renderWidth,g=0,y=this.options.renderHeight;h&&(c=this.options.renderWidth/h*l,m=this.options.renderWidth/h*(l+1),l++),d&&(g=this.options.renderHeight/d*p,y=this.options.renderHeight/d*(p+1)),l===h&&(l=0,p++),p===d&&(p=0),r.orbs[u]={radius:i,posX:Math.random()*m+c,posY:Math.random()*y+g,velX:Math.round(Math.random())?Math.random()*s:-(Math.random()*s),velY:Math.round(Math.random())?Math.random()*s:-(Math.random()*s),minX:c,maxX:m,minY:g,maxY:y}}return r},GaussianBackground.prototype.displayLoop=function(){this.options.animation&&(this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this)));var t=Date.now(),i=t-this.lastCallTime;(i>this.timestep||!this.options.animation)&&(this.lastCallTime=t-i%this.timestep,this.timeElapsed=this.lastCallTime-this.firstCallTime,this.fpsTotal++,this.fpsAverage=this.fpsTotal/(this.timeElapsed/1e3),this.drawBackground(),this.options.blur&&this.drawBlur(),this.options.debug&&this.debug())},GaussianBackground.prototype.drawBackground=function(){for(var t=Object.keys(this.layers).length-1;t>=0;t--){var i=this.layers[t].context,s=this.layers[t].orbs;i.fillStyle=this.layers[t].color,i.fillRect(0,0,this.options.renderWidth,this.options.renderHeight);for(var e=Object.keys(s).length-1;e>=0;e--)s[e].posX+=s[e].velX,s[e].posY+=s[e].velY,s[e].posX<s[e].maxX?s[e].posX>s[e].minX||(s[e].posX=s[e].minX,s[e].velX=-s[e].velX):(s[e].posX=s[e].maxX,s[e].velX=-s[e].velX),s[e].posY<s[e].maxY?s[e].posY>s[e].minY||(s[e].posY=s[e].minY,s[e].velY=-s[e].velY):(s[e].posY=s[e].maxY,s[e].velY=-s[e].velY),i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(s[e].posX,s[e].posY,s[e].radius,0,2*Math.PI,!1),i.fill(),i.restore();this.context.drawImage(i.canvas,0,0)}},GaussianBackground.prototype.drawBlur=function(){switch(this.options.blurMethod){case"stackblur":stackBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius);break;case"fastblur":boxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case"integralblur":integralBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case"stackboxblur":stackBoxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations)}},GaussianBackground.prototype.debug=function(){if(!document.getElementById(this.context.canvas.id+"DebugDisplay")){var t=document.createElement("div");t.id=this.context.canvas.id+"DebugDisplay",t.style.position="fixed",t.style.bottom="10px",t.style.left="10px",t.style.color="#00ff00",t.style.fontFamily="sans-serif",document.getElementsByTagName("body")[0].appendChild(t)}document.getElementById(this.context.canvas.id+"DebugDisplay").innerHTML=this.debugDisplay(),this.debugLayerBoundaries()},GaussianBackground.prototype.debugDisplay=function(){return(this.options.animation?"FPS Average: "+Math.round(this.fpsAverage):"")+(this.options.animation?"<br />FPS Cap: "+Math.round(this.options.fpsCap):"")+"<br />Render Width: "+this.options.renderWidth+"px<br />Render Height: "+this.options.renderHeight+"px<br />Layers: "+Object.keys(this.layers).length+"<br />Animation: "+(this.options.animation?"Yes":"No")+(this.options.blur?"<br />Blur Algorithm: "+this.options.blurMethod:"")+(this.options.blur?"<br />Blur Radius: "+this.options.blurRadius:"")+(this.options.blur?"<br />Blur Iterations: "+this.options.blurIterations:"")},GaussianBackground.prototype.debugLayerBoundaries=function(){for(var t=Object.keys(this.layers).length-1;t>=0;t--)for(var i=(this.layers[t].context,this.layers[t].orbs),s=parseInt(Object.keys(i).length+""+(t+1))/100,e=Object.keys(i).length-1;e>=0;e--)i[e].maxX&&i[e].maxY&&(this.context.beginPath(),this.context.lineWidth="1",this.context.strokeStyle="#"+(16777215*s<<0).toString(16),this.context.rect(i[e].minX,i[e].minY,i[e].maxX-i[e].minX,i[e].maxY-i[e].minY),this.context.stroke())},GaussianBackground.prototype.refreshLayers=function(){this.updateLayers(this.layersBackup)},GaussianBackground.prototype.updateLayers=function(t){this.layers={},this.layersBackup=JSON.parse(JSON.stringify(t));for(var i=Object.keys(t).length-1;i>=0;i--)this.layers[i]=this.generateLayer(t[i].orbs,t[i].radius,t[i].maxVelocity,t[i].color,t[i].columns,t[i].rows)},GaussianBackground.prototype.updateOptions=function(t){for(var i in t)this.options[i]=t[i];if(document.getElementById(this.context.canvas.id+"DebugDisplay")){var s=document.getElementById(this.context.canvas.id+"DebugDisplay");s.parentNode.removeChild(s)}this.timestep=1e3/parseFloat(this.options.fpsCap),this.context.canvas.width=this.options.renderWidth,this.context.canvas.height=this.options.renderHeight,this.refreshLayers(),this.play()},GaussianBackground.prototype.pause=function(){window.cancelAnimationFrame(this.animationFrame)},GaussianBackground.prototype.play=function(){window.cancelAnimationFrame(this.animationFrame),this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this))};