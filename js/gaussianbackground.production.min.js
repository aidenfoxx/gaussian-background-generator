/** 
 * Gaussian Background Generator 
 * 
 * @version    0.5.1
 * @author     Aiden Foxx
 * @license    MIT License 
 * @copyright  2015 Aiden Foxx
 * @link       http://github.com/aidenfoxx
 * @twitter    @furiousfoxx
 */ 
function GaussianBackground(d,c,a){if(!(this instanceof GaussianBackground))return new GaussianBackground(d,c,a);this.animationFrame=this.context=null;this.lastCallTime=this.firstCallTime=this.timestep=0;this.layers={};this.layersBackup={};this.options={blur:!0,blurRadius:50,blurMethod:"stackblur",blurIterations:0,animation:!0,fpsCap:20,renderWidth:320,renderHeight:130};if(!(this.context=d.getContext("2d")))return console.log("ERROR: Could not load canvas"),!1;this.updateOptions(a);this.updateLayers(c);
this.context.canvas.width=this.options.renderWidth;this.context.canvas.height=this.options.renderHeight;this.lastCallTime=this.firstCallTime=Date.now();this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this))}
GaussianBackground.prototype.generateLayer=function(d,c,a,b,f,g){var e=document.createElement("canvas");e.width=this.options.renderWidth;e.height=this.options.renderHeight;b={orbs:{},color:b,context:e.getContext("2d")};f=f||0;g=g||0;for(var h=e=0,k=0;k<d;k++){var l=0,m=this.options.renderWidth,n=0,p=this.options.renderHeight;f&&(l=this.options.renderWidth/f*e,m=this.options.renderWidth/f*(e+1),e++);g&&(n=this.options.renderHeight/g*h,p=this.options.renderHeight/g*(h+1));e===f&&(e=0,h++);h===g&&(h=
0);b.orbs[k]={radius:c,posX:Math.random()*m+l,posY:Math.random()*p+n,velX:Math.round(Math.random())?Math.random()*a:-(Math.random()*a),velY:Math.round(Math.random())?Math.random()*a:-(Math.random()*a),minX:l,maxX:m,minY:n,maxY:p}}return b};
GaussianBackground.prototype.displayLoop=function(){this.options.animation&&(this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this)));var d=Date.now(),c=d-this.lastCallTime;if(c>this.timestep||!this.options.animation)this.lastCallTime=d-c%this.timestep,this.drawBackground(),this.options.blur&&this.drawBlur()};
GaussianBackground.prototype.drawBackground=function(){for(var d=Object.keys(this.layers).length-1;0<=d;d--){var c=this.layers[d].context,a=this.layers[d].orbs;c.fillStyle=this.layers[d].color;c.fillRect(0,0,this.options.renderWidth,this.options.renderHeight);for(var b=Object.keys(a).length-1;0<=b;b--)a[b].posX+=a[b].velX,a[b].posY+=a[b].velY,a[b].posX>=a[b].maxX?(a[b].posX=a[b].maxX,a[b].velX=-a[b].velX):a[b].posX<=a[b].minX&&(a[b].posX=a[b].minX,a[b].velX=-a[b].velX),a[b].posY>=a[b].maxY?(a[b].posY=
a[b].maxY,a[b].velY=-a[b].velY):a[b].posY<=a[b].minY&&(a[b].posY=a[b].minY,a[b].velY=-a[b].velY),c.save(),c.globalCompositeOperation="destination-out",c.beginPath(),c.arc(a[b].posX,a[b].posY,a[b].radius,0,2*Math.PI,!1),c.fill(),c.restore();this.context.drawImage(c.canvas,0,0)}};
GaussianBackground.prototype.drawBlur=function(){switch(this.options.blurMethod){case "stackblur":stackBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius);break;case "fastblur":boxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case "integralblur":integralBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,
this.options.blurRadius,this.options.blurIterations);break;case "stackboxblur":stackBoxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations)}};GaussianBackground.prototype.refreshLayers=function(){this.updateLayers(this.layersBackup)};
GaussianBackground.prototype.updateLayers=function(d){this.layers={};this.layersBackup=JSON.parse(JSON.stringify(d));for(var c=Object.keys(d).length-1;0<=c;c--)this.layers[c]=this.generateLayer(d[c].orbs,d[c].radius,d[c].maxVelocity,d[c].color,d[c].columns,d[c].rows)};
GaussianBackground.prototype.updateOptions=function(d){for(var c in d)this.options[c]=d[c];this.timestep=1E3/parseFloat(this.options.fpsCap);this.context.canvas.width=this.options.renderWidth;this.context.canvas.height=this.options.renderHeight;this.refreshLayers();this.play()};GaussianBackground.prototype.pause=function(){window.cancelAnimationFrame(this.animationFrame)};GaussianBackground.prototype.play=function(){window.cancelAnimationFrame(this.animationFrame);this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this))};