/** 
 * Gaussian Background Generator 
 * 
 * @version    0.5.1
 * @author     Aiden Foxx
 * @license    MIT License 
 * @copyright  2015 Aiden Foxx
 * @link       http://github.com/aidenfoxx
 * @twitter    @furiousfoxx
 */
function GaussianBackground(c,d,b){if(!(this instanceof GaussianBackground))return new GaussianBackground(c,d,b);this.animationFrame=this.context=null;this.fpsTotal=this.fpsAverage=this.timeElapsed=this.lastCallTime=this.firstCallTime=this.timestep=0;this.layers={};this.layersBackup={};this.options={debug:!1,blur:!0,blurRadius:50,blurMethod:"stackblur",blurIterations:0,animation:!0,fpsCap:20,renderWidth:320,renderHeight:130};if(!(this.context=c.getContext("2d")))return console.log("ERROR: Could not load canvas"),
!1;this.updateOptions(b);this.updateLayers(d);this.context.canvas.width=this.options.renderWidth;this.context.canvas.height=this.options.renderHeight;this.lastCallTime=this.firstCallTime=Date.now();this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this))}
GaussianBackground.prototype.generateLayer=function(c,d,b,a,f,g){var e=document.createElement("canvas");e.width=this.options.renderWidth;e.height=this.options.renderHeight;a={orbs:{},color:a,context:e.getContext("2d")};f=f||0;g=g||0;for(var h=e=0,k=0;k<c;k++){var l=0,m=this.options.renderWidth,n=0,p=this.options.renderHeight;f&&(l=this.options.renderWidth/f*e,m=this.options.renderWidth/f*(e+1),e++);g&&(n=this.options.renderHeight/g*h,p=this.options.renderHeight/g*(h+1));e===f&&(e=0,h++);h===g&&(h=
0);a.orbs[k]={radius:d,posX:Math.random()*m+l,posY:Math.random()*p+n,velX:Math.round(Math.random())?Math.random()*b:-(Math.random()*b),velY:Math.round(Math.random())?Math.random()*b:-(Math.random()*b),minX:l,maxX:m,minY:n,maxY:p}}return a};
GaussianBackground.prototype.displayLoop=function(){this.options.animation&&(this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this)));var c=Date.now(),d=c-this.lastCallTime;if(d>this.timestep||!this.options.animation)this.lastCallTime=c-d%this.timestep,this.timeElapsed=this.lastCallTime-this.firstCallTime,this.fpsTotal++,this.fpsAverage=this.fpsTotal/(this.timeElapsed/1E3),this.drawBackground(),this.options.blur&&this.drawBlur(),this.options.debug&&this.debug()};
GaussianBackground.prototype.drawBackground=function(){for(var c=Object.keys(this.layers).length-1;0<=c;c--){var d=this.layers[c].context,b=this.layers[c].orbs;d.fillStyle=this.layers[c].color;d.fillRect(0,0,this.options.renderWidth,this.options.renderHeight);for(var a=Object.keys(b).length-1;0<=a;a--)this.options.animation&&(b[a].posX+=b[a].velX,b[a].posY+=b[a].velY,b[a].posX>=b[a].maxX?(b[a].posX=b[a].maxX,b[a].velX=-b[a].velX):b[a].posX<=b[a].minX&&(b[a].posX=b[a].minX,b[a].velX=-b[a].velX),b[a].posY>=
b[a].maxY?(b[a].posY=b[a].maxY,b[a].velY=-b[a].velY):b[a].posY<=b[a].minY&&(b[a].posY=b[a].minY,b[a].velY=-b[a].velY)),d.save(),d.globalCompositeOperation="destination-out",d.beginPath(),d.arc(b[a].posX,b[a].posY,b[a].radius,0,2*Math.PI,!1),d.fill(),d.restore();this.context.drawImage(d.canvas,0,0)}};
GaussianBackground.prototype.drawBlur=function(){switch(this.options.blurMethod){case "stackblur":stackBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius);break;case "fastblur":boxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case "integralblur":integralBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,
this.options.blurRadius,this.options.blurIterations);break;case "stackboxblur":stackBoxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations)}};
GaussianBackground.prototype.debug=function(){if(!document.getElementById(this.context.canvas.id+"DebugDisplay")){var c=document.createElement("div");c.id=this.context.canvas.id+"DebugDisplay";c.style.position="fixed";c.style.bottom="10px";c.style.left="10px";c.style.color="#00ff00";c.style.fontFamily="sans-serif";document.getElementsByTagName("body")[0].appendChild(c)}document.getElementById(this.context.canvas.id+"DebugDisplay").innerHTML=this.debugDisplay();this.debugLayerBoundaries()};
GaussianBackground.prototype.debugDisplay=function(){return(this.options.animation?"FPS Average: "+Math.round(this.fpsAverage):"")+(this.options.animation?"<br />FPS Cap: "+Math.round(this.options.fpsCap):"")+"<br />Render Width: "+this.options.renderWidth+"px<br />Render Height: "+this.options.renderHeight+"px<br />Layers: "+Object.keys(this.layers).length+"<br />Animation: "+(this.options.animation?"Yes":"No")+(this.options.blur?"<br />Blur Algorithm: "+this.options.blurMethod:"")+(this.options.blur?
"<br />Blur Radius: "+this.options.blurRadius:"")+(this.options.blur?"<br />Blur Iterations: "+this.options.blurIterations:"")};
GaussianBackground.prototype.debugLayerBoundaries=function(){for(var c=Object.keys(this.layers).length-1;0<=c;c--)for(var d=this.layers[c].orbs,b=parseInt(Object.keys(d).length+""+(c+1))/100,a=Object.keys(d).length-1;0<=a;a--)d[a].maxX&&d[a].maxY&&(this.context.beginPath(),this.context.lineWidth="1",this.context.strokeStyle="#"+(16777215*b<<0).toString(16),this.context.rect(d[a].minX,d[a].minY,d[a].maxX-d[a].minX,d[a].maxY-d[a].minY),this.context.stroke())};
GaussianBackground.prototype.refreshLayers=function(){this.updateLayers(this.layersBackup)};GaussianBackground.prototype.updateLayers=function(c){this.layers={};this.layersBackup=JSON.parse(JSON.stringify(c));for(var d=Object.keys(c).length-1;0<=d;d--)this.layers[d]=this.generateLayer(c[d].orbs,c[d].radius,c[d].maxVelocity,c[d].color,c[d].columns,c[d].rows)};
GaussianBackground.prototype.updateOptions=function(c){for(var d in c)this.options[d]=c[d];document.getElementById(this.context.canvas.id+"DebugDisplay")&&(c=document.getElementById(this.context.canvas.id+"DebugDisplay"),c.parentNode.removeChild(c));this.timestep=1E3/parseFloat(this.options.fpsCap);this.context.canvas.width=this.options.renderWidth;this.context.canvas.height=this.options.renderHeight;this.refreshLayers();this.play()};GaussianBackground.prototype.pause=function(){window.cancelAnimationFrame(this.animationFrame)};
GaussianBackground.prototype.play=function(){window.cancelAnimationFrame(this.animationFrame);this.animationFrame=window.requestAnimationFrame(this.displayLoop.bind(this))};