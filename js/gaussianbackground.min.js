"use strict";function GaussianBackground(t,i,s){return this instanceof GaussianBackground?(this.context=null,this.animationFrame=null,this.timestep=0,this.firstCallTime=0,this.lastCallTime=0,this.timeElapsed=0,this.fpsAverage=0,this.fpsTotal=0,this.layers={},this.options={debug:!1,blur:!0,blurRadius:50,blurMethod:"stackblur",blurIterations:0,animation:!0,fpsCap:20,renderWidth:320,renderHeight:130},(this.context=document.getElementById(t).getContext("2d"))?(this.updateOptions(s),this.updateLayers(i),this.context.canvas.width=this.options.renderWidth,this.context.canvas.height=this.options.renderHeight,this.firstCallTime=Date.now(),this.lastCallTime=this.firstCallTime,cancelAnimationFrame(this.animationFrame),void(this.animationFrame=requestAnimationFrame(this.displayLoop.bind(this)))):(console.log("ERROR: Could not load canvas"),!1)):new GaussianBackground(t,i,s)}GaussianBackground.prototype.generateLayer=function(t,i,s,e,n,a){var o=document.createElement("canvas");o.width=this.options.renderWidth,o.height=this.options.renderHeight;for(var r={orbs:{},color:e,canvas:o,context:o.getContext("2d")},h=0,d=0,l=0;t>l;l++){if(n){var p=this.options.renderWidth/n*h,u=this.options.renderWidth/n*(h+1),c=0,m=this.options.renderHeight;h++}if(a)var p=p?p:0,u=u?u:this.options.renderWidth,c=this.options.renderHeight/a*d,m=this.options.renderHeight/a*(d+1);h===n&&(h=0,d++),d===a&&(d=0),r.orbs[l]={radius:i,posX:n?Math.random()*u+p:Math.random()*this.options.renderWidth,posY:a?Math.random()*m+c:Math.random()*this.options.renderHeight,velX:Math.round(Math.random())?Math.random()*s:-(Math.random()*s),velY:Math.round(Math.random())?Math.random()*s:-(Math.random()*s),minX:p,maxX:u,minY:c,maxY:m}}return r},GaussianBackground.prototype.displayLoop=function(){this.options.animation&&(this.animationFrame=requestAnimationFrame(this.displayLoop.bind(this)));var t=Date.now(),i=t-this.lastCallTime;(i>this.timestep||!this.options.animation)&&(this.lastCallTime=t-i%this.timestep,this.timeElapsed=this.lastCallTime-this.firstCallTime,this.fpsTotal++,this.fpsAverage=this.fpsTotal/(this.timeElapsed/1e3),this.drawBackground(),this.options.blur&&this.drawBlur(),this.options.debug&&this.debug())},GaussianBackground.prototype.drawBackground=function(){for(var t=Object.keys(this.layers).length-1;t>=0;t--){var i=this.layers[t].canvas,s=this.layers[t].context,e=this.layers[t].orbs;s.fillStyle=this.layers[t].color,s.fillRect(0,0,this.options.renderWidth,this.options.renderHeight);for(var n=Object.keys(e).length-1;n>=0;n--){if(e[n].posX+=e[n].velX,e[n].posY+=e[n].velY,e[n].maxX&&e[n].maxY)var a=e[n].minX,o=e[n].maxX,r=e[n].minY,h=e[n].maxY;else var a=0,o=this.options.renderWidth,r=0,h=this.options.renderHeight;e[n].posX<o?e[n].posX>a||(e[n].posX=a,e[n].velX=-e[n].velX):(e[n].posX=o,e[n].velX=-e[n].velX),e[n].posY<h?e[n].posY>r||(e[n].posY=r,e[n].velY=-e[n].velY):(e[n].posY=h,e[n].velY=-e[n].velY),s.save(),s.globalCompositeOperation="destination-out",s.beginPath(),s.arc(e[n].posX,e[n].posY,e[n].radius,0,2*Math.PI,!1),s.fill(),s.restore()}this.context.drawImage(i,0,0)}},GaussianBackground.prototype.drawBlur=function(){switch(this.options.blurMethod){case"stackblur":stackBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius);break;case"fastblur":boxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case"integralblur":integralBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations);break;case"stackboxblur":stackBoxBlurCanvasRGB(this.context.canvas.id,0,0,this.options.renderWidth,this.options.renderHeight,this.options.blurRadius,this.options.blurIterations)}},GaussianBackground.prototype.debug=function(){if(this.debugLayerBoundaries(),!document.getElementById(this.context.canvas.id+"DebugDisplay")){var t=document.createElement("div");t.id=this.context.canvas.id+"DebugDisplay",t.style.position="fixed",t.style.bottom="10px",t.style.left="10px",t.style.color="#00ff00",t.style.fontFamily="sans-serif",document.getElementsByTagName("body")[0].appendChild(t)}document.getElementById(this.context.canvas.id+"DebugDisplay").innerHTML=this.debugDisplay()},GaussianBackground.prototype.debugDisplay=function(){return(this.options.animation?"FPS Average: "+Math.round(this.fpsAverage):"")+(this.options.animation?"<br />FPS Cap: "+Math.round(this.options.fpsCap):"")+"<br />Render Width: "+this.options.renderWidth+"px<br />Render Height: "+this.options.renderHeight+"px<br />Layers: "+Object.keys(this.layers).length+"<br />Animation: "+(this.options.animation?"Yes":"No")+(this.options.blur?"<br />Blur Algorithm: "+this.options.blurMethod:"")+(this.options.blur?"<br />Blur Radius: "+this.options.blurRadius:"")+(this.options.blur?"<br />Blur Iterations: "+this.options.blurIterations:"")},GaussianBackground.prototype.debugLayerBoundaries=function(){for(var t=Object.keys(this.layers).length-1;t>=0;t--)for(var i=(this.layers[t].context,this.layers[t].orbs),s=(Object.keys(i).length+""+(t+1))/100,e=Object.keys(i).length-1;e>=0;e--)i[e].maxX&&i[e].maxY&&(this.context.beginPath(),this.context.lineWidth="1",this.context.strokeStyle="#"+(16777215*s<<0).toString(16),this.context.rect(i[e].minX,i[e].minY,i[e].maxX-i[e].minX,i[e].maxY-i[e].minY),this.context.stroke())},GaussianBackground.prototype.updateLayers=function(t){this.layers={};for(var i=Object.keys(t).length-1;i>=0;i--)this.layers[i]=this.generateLayer(t[i].orbs,t[i].radius,t[i].maxVelocity,t[i].color,t[i].splitX,t[i].splitY)},GaussianBackground.prototype.updateOptions=function(t){for(var i in t)this.options[i]=t[i];if(document.getElementById(this.context.canvas.id+"DebugDisplay")){var s=document.getElementById(this.context.canvas.id+"DebugDisplay");s.parentNode.removeChild(s)}this.timestep=1e3/parseFloat(this.options.fpsCap),this.context.canvas.width=this.options.renderWidth,this.context.canvas.height=this.options.renderHeight;for(var e=Object.keys(this.layers).length-1;e>=0;e--)this.layers[e].canvas.width=this.options.renderWidth,this.layers[e].canvas.height=this.options.renderHeight;this.play()},GaussianBackground.prototype.pause=function(){cancelAnimationFrame(this.animationFrame)},GaussianBackground.prototype.play=function(){cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(this.displayLoop.bind(this))};